<% if (options.page === 'homepage') { 

	// if there's no more issues left
	if (!comic.to_read) {
		return;
	}

	// img
	comic.to_read.image = comic.to_read.image.replace('{{code}}', options.image_code);

	// last read
	var last_read_issue = comic.issues.reduce((prev, current) => (new Date(prev.read) > new Date(current.read)) ? prev : current);
	var last_read = last_read_issue.issue_number;

	// number of issues left to read
	var issues_left = comic.issues.filter(i => { return !i.read && i.id !== comic.to_read.id && new Date() >= new Date(i.store_date); }).length;

	//new
    var is_new = Math.floor(Math.abs(new Date(comic.to_read.store_date) - new Date()) / 1000 / 86400) < 7;

	// progress bar percentage
	var progress = (comic.nb_issues-issues_left-1)/comic.nb_issues*100;
	%>

	<!-- ITEM -->
	<li id="comics-item-<%= comic.id %>" data-comics="<%= comic.id %>" data-issue="<%= comic.to_read.id %>" class="comics <%= is_new ? 'new' : ''%>">

		<!-- .nav -->
		<div class="nav">
			<a href="#" class="read-btn popover-link" title="" data-original-title="Mark as read">
				<i class="to-read-icon icon-tvst-read">âœ“</i>
				<i class="read-icon icon-tvst-check"></i>
			</a>
		</div>
		<!-- // .nav -->

		<div class="image-crop">
			<div class="new-label">New</div>
			<a href="<%= comic.link %>">
				<img id="img-<%= comic.id %>" src="<%= comic.to_read.image %>" alt="<%= comic.name %>">
			</a>
			<div class="progress">
				<div class="progress-bar progress-bar-success uncomplete" role="progressbar" aria-valuenow="<%= progress %>" aria-valuemin="0" aria-valuemax="100" style="width: <%= progress %>%">
				</div>
			</div>
			<!--div class="overlay">
				<a href="#" class="zoom-btn overlay-btn" title="Infos">
					<i class="zoom-icon icon-tvst-search"></i>
				</a>
			</div-->
		</div>

		<div class="issue-details cover-details">
			<h2><a href="<%= comic.link %>"><%= comic.name %> <span class="issue-number">#<%= comic.to_read.issue_number %></span></a>
				<!--span class="nb-remainging-issues">+ X more</span-->
			</h2>
			<!--a class="nb-reviews-link secondary-link" href="#">+ x more</a-->
			<span class="nb-remainging-issues" title="<%= comic.nb_issues + ' issues' %>"><% if (issues_left) { %>+ <span class="remainging-issues"><%= issues_left %></span> more<% } %></span>

		</div>
	</li>
	<!-- // ITEM -->

<% } else if (options.page === 'comics') { %>

	<%# debug %>
	<div class="comics-issue">
		<div class="comics-issue-top">
			<div class="comics-issue-controls">
				<span class="comics-issue-control comics-issue-closed"><i class="fas fa-angle-down"></i></span>
				<span class="comics-issue-control comics-issue-opened"><i class="fas fa-angle-up"></i></span>
			</div>

			<div class="comics-issue-title">
				<%= comic.name + ' (' + comic.start_year + ')' %>
			</div>

			<div class="comics-issue-status">
				<span class="comics-issue-status-read">
					<i class="fas fa-check-circle fa-read-status <%= comics.filter(c => c.to_read).length ? 'fa-read' : '' %>"></i>
				</span>
			</div>
		</div>
		<div class="comics-issue-bottom">
			<pre style="white-space:normal;font-size: 12px;padding-top:30px;"><code class="language-javascript"><%= JSON.stringify(comic) %></code></pre>
		</div>
	</div>
	<%# /debug %>


	<% comic.issues.forEach( issue => { %>
		<%- include('issue.ejs', {comic: comic, issue: issue}) %>
	<% })

} else if (options.page === 'issue') {

	const issue = comic.issues.filter(i => i.issue_number == issue_number, issue_number)

	%>
	<%- include('issue.ejs', {comic: comic, issue: comic.issue}) %>

<% } else { %>

	<%
		const isHomepage = typeof options.page === 'undefined' || options.page === 'homepage';
		comic.link = isHomepage ? ('comics/' + comic.id) : (options.page === 'issue' ? '../' : './' + comic.id);
		comic.image_code = isHomepage ? 'scale_avatar' : (options.page === 'comics' ? 'scale_small' : 'scale_avatar');
		comic.full_name = comic.name + ' (' + comic.start_year + ')';
	%>

	<% if (!isHomepage) { %>
		<a href="..">Retour</a><br/>
	<% } %>

	<a href="<%= comic.link %>">
		<img src="<%= comic.image.replace('{{code}}', comic.image_code) %>" />
	</a><br/>

	<li>Link: <%= comic.link %></li>

	<li><a href="<%= comic.link %>"><%= comic.full_name %></a></li>
	<li>Name: <%= comic.name %></li>
	<li>Number of issues: <%= comic.nb_issues %></li>
	<li>Publisher: <%= comic.publisher.name %></li>
	<li>Start year: <%= comic.start_year %></li>
	<li>Added: <%= comic.date.added %></li>
	<li>Updated: <%= comic.date.updated %></li>

	<li><a href="<%= comic.link %>">See all issues</a></li>

<% } %>